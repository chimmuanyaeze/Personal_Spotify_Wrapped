{% extends "wrapped/base.html" %}
{% load static %}
    {% block title %}Upload Spotify Data{% endblock title %} 
    {% block style %}
    <style>
        body {
            background: radial-gradient(circle at top, #1db95420, #020617 60%);
            min-height: 100vh;
            color: #f8fafc;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .upload-card {
            background: #020617;
            border-radius: 24px;
            padding: 40px;
            max-width: 520px;
            width: 100%;
            box-shadow: 0 20px 50px rgba(0,0,0,0.6);
            animation: fadeUp 0.8s ease forwards;
        }

        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .highlight {
            color: #22c55e;
        }

        .file-box {
            border: 2px dashed #334155;
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
        }

        .file-box:hover {
            border-color: #22c55e;
            background: #020617;
        }

        input[type="file"] {
            display: none;
        }

        .btn-success {
            background: #22c55e;
            border: none;
            padding: 14px;
            font-size: 1.1rem;
            border-radius: 14px;
        }

        .btn-success:hover {
            background: #16a34a;
        }

        .privacy {
            font-size: 0.9rem;
            color: #94a3b8;
        }

        footer {
            padding: 60px 20px;
            color: #94a3b8;
            text-align: center;
            font-size: 0.95rem;
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .upload-card {
                padding: 24px;
                margin: 20px;
            }

            .file-box {
                padding: 20px;
            }

            h1 {
                font-size: 1.75rem;
            }

            body {
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .upload-card {
                padding: 16px;
                border-radius: 16px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .btn-success {
                padding: 12px;
                font-size: 1rem;
            }

            .file-box {
                padding: 16px;
            }
        }
    </style>
    {% endblock style %}

{% block content %}

<div class="upload-card">
    <h1 class="fw-bold text-center mb-3">
        Your Spotify Wrapped ðŸŽ§
    </h1>

    <p class="text-center text-secondary mb-4">
        Upload your Spotify streaming history and relive your music journey.
    </p>

    {% if error %}
        <div class="alert alert-danger text-center">
            {{ error }}
        </div>
    {% endif %}

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <label class="file-box mb-4 w-100">
            <strong class="highlight">Click to upload</strong>
            <p class="mb-1">Streaming_History_Extended.json</p>
            <small class="text-secondary">
                You can upload multiple files
            </small>
            <input
                type="file"
                name="spotify_files"
                multiple
                accept=".json"
                required
            >
        </label>

        <button type="submit" class="btn btn-success w-100">
            Generate My Wrapped
        </button>
    </form>

    <p class="privacy text-center mt-4">
        Your data is processed locally, never stored, and deleted automatically.
    </p>
</div>

<script async defer data-domain="personal-spotify-wrapped.onrender.com"
        src="https://plausible.io/js/plausible.js">
const form = document.querySelector("form");

// Create a loader overlay div
const loader = document.createElement("div");
loader.style.position = "fixed";
loader.style.top = "0";
loader.style.left = "0";
loader.style.width = "100%";
loader.style.height = "100%";
loader.style.background = "rgba(15, 23, 42, 0.95)";
loader.style.display = "flex";
loader.style.alignItems = "center";
loader.style.justifyContent = "center";
loader.style.flexDirection = "column";
loader.style.color = "#22c55e";
loader.style.fontSize = "1.5rem";
loader.style.zIndex = "9999";
loader.style.display = "none"; // hidden by default
loader.innerHTML = `
    <h2 class="highlight mb-2">Creating your Wrapped ðŸŽ§</h2>
    <p class="text-secondary">Analyzing your listening historyâ€¦</p>
`;
document.body.appendChild(loader);

form.addEventListener("submit", function () {
    loader.style.display = "flex"; // show overlay
    form.querySelector("button[type='submit']").disabled = true;
});
</script>
{%endblock content %}
